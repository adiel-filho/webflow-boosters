(()=>{const e="[sd-masonry]";class t{constructor(t,r){this.galleryElement=t,this.galleryItems=Array.from(r),this.galleryClassName="c-masonry-layout",this.columnClassName="c-masonry-column",this.itemClassName="c-masonry-item",this.useBalance=t.hasAttribute("sd-balance"),this.cssValues=this.extractCSSValues(),this.columnCount=this.cssValues.columnCount,this.columnGap=this.cssValues.columnGap,this.galleryStyles={display:"flex","flex-wrap":"wrap","justify-content":"flex-start"},this.generate(this.columnCount),this.handleResponsive(),this.handleImages()}extractCSSValues(){const t=window.getComputedStyle(this.galleryElement),e=t.columnCount,r=t.columnGap;let n;if("auto"===e)n=this.calculateAutoColumns();else if("none"===e||"inherit"===e)n=3;else{const t=parseInt(e,10);n=isNaN(t)?3:Math.max(t,1)}const i=parseFloat(r)||20;return{columnCount:n,columnGap:i}}calculateAutoColumns(){const t=this.galleryElement.offsetWidth,e=200;return Math.floor(t/e)||1}generate(t){const e=[];this.galleryElement.classList.add(this.galleryClassName),Object.assign(this.galleryElement.style,this.galleryStyles),this.columnGap>0&&(this.galleryElement.style.gap=`${this.columnGap}px`);for(let r=1;r<=t;r++){const t=document.createElement("div");t.classList.add(this.columnClassName,`column-${r}`),t.style.flex="1",t.style.minWidth="0",this.galleryElement.append(t),e.push(t)}this.useBalance?this.distributeItemsIntelligently(e):this.distributeItemsSequentially(e)}distributeItemsSequentially(t){this.galleryItems.forEach((e,r)=>{const n=r%t.length,i=t[n];i.append(e),e.classList.add(this.itemClassName),this.columnGap>0&&(e.style.marginBottom=`${this.columnGap}px`)})}distributeItemsIntelligently(t){const e=new Array(t.length).fill(0);this.galleryItems.forEach(r=>{const n=e.indexOf(Math.min(...e)),i=t[n];i.append(r),r.classList.add(this.itemClassName),this.columnGap>0&&(r.style.marginBottom=`${this.columnGap}px`),e[n]+=r.offsetHeight,this.columnGap>0&&(e[n]+=this.columnGap)})}handleResponsive(){let t=null;const e=()=>{if(t)return;t=requestAnimationFrame(()=>{t=null;const e=this.extractCSSValues(),r=e.columnCount,n=e.columnGap;if(r!==this.columnCount||n!==this.columnGap){this.columnCount=r,this.columnGap=n,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(t=>t.remove()),this.generate(this.columnCount)}})};window.addEventListener("resize",e)}handleImages(){this.galleryItems.forEach(t=>{t.querySelectorAll?.("img").forEach(e=>{e.complete||e.addEventListener("load",()=>{const t=this.extractCSSValues(),e=t.columnGap!==this.columnGap,r=t.columnCount!==this.columnCount;e||r?(this.columnGap=t.columnGap,this.columnCount=t.columnCount,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(t=>t.remove()),this.generate(this.columnCount)):(this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(t=>t.remove()),this.generate(this.columnCount))},{once:!0})})}),window.addEventListener("load",()=>{this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(t=>t.remove()),this.generate(this.columnCount)},{once:!0})}}if("loading"===document.readyState){document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll(e).forEach(t=>{if("1"===t.dataset.masonryInited)return;const e=t.querySelectorAll(":scope > *");new t(t,e),t.dataset.masonryInited="1"})})}else{const t=()=>{document.querySelectorAll(e).forEach(t=>{if("1"===t.dataset.masonryInited)return;const e=t.querySelectorAll(":scope > *");new t(t,e),t.dataset.masonryInited="1"})};t()}const r=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(1!==t.nodeType)return;t.matches&&t.matches(e)&&"1"!==t.dataset.masonryInited&&(t.querySelectorAll(":scope > *"),new t(t,t.querySelectorAll(":scope > *")),t.dataset.masonryInited="1");const e=t.querySelectorAll?.(e);e&&e.forEach(t=>{"1"!==t.dataset.masonryInited&&(t.querySelectorAll(":scope > *"),new t(t,t.querySelectorAll(":scope > *")),t.dataset.masonryInited="1")})})})});r.observe(document.body,{childList:!0,subtree:!0})})();
