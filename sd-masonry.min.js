(()=>{const S="[sd-masonry]";class M{constructor(e,t){this.galleryElement=e,this.galleryItems=Array.from(t),this.galleryClassName="c-masonry-layout",this.columnClassName="c-masonry-column",this.itemClassName="c-masonry-item",this.useBalance=e.hasAttribute("sd-balance")||e.hasAttribute("sd-masonry-balance"),this.cssValues=this.extractCSSValues(),this.columnCount=this.cssValues.columnCount,this.columnGap=this.cssValues.columnGap,this.galleryStyles={display:"flex","flex-wrap":"wrap","justify-content":"flex-start"},this.generate(this.columnCount),this.handleResponsive(),this.handleImages()}extractCSSValues(){const e=window.getComputedStyle(this.galleryElement),t=e.columnCount,i=e.columnGap;let n;"auto"===t?n=this.calculateAutoColumns():"none"!==t&&"inherit"!==t?(n=Math.max(parseInt(t,10)||1,1)):n=3;const l=parseFloat(i)||20;return{columnCount:n,columnGap:l}}calculateAutoColumns(){const e=this.galleryElement.offsetWidth,t=200;return Math.floor(e/t)||1}generate(e){const t=[];this.galleryElement.classList.add(this.galleryClassName),Object.assign(this.galleryElement.style,this.galleryStyles),this.columnGap>0&&(this.galleryElement.style.gap=`${this.columnGap}px`);for(let i=1;i<=e;i++){const e=document.createElement("div");e.classList.add(this.columnClassName,`column-${i}`),e.style.flex="1",e.style.minWidth="0",this.galleryElement.append(e),t.push(e)}this.useBalance?this.distributeItemsIntelligently(t):this.distributeItemsSequentially(t)}distributeItemsSequentially(e){this.galleryItems.forEach((t,i)=>{const n=e[i%e.length];n.append(t),t.classList.add(this.itemClassName),this.columnGap>0&&(t.style.marginBottom=`${this.columnGap}px`)})}distributeItemsIntelligently(e){const t=new Array(e.length).fill(0);this.galleryItems.forEach(i=>{const n=t.indexOf(Math.min(...t)),l=e[n];l.append(i),i.classList.add(this.itemClassName),this.columnGap>0&&(i.style.marginBottom=`${this.columnGap}px`),t[n]+=i.offsetHeight,this.columnGap>0&&(t[n]+=this.columnGap)})}handleResponsive(){let e=null;const t=()=>{if(e)return;e=requestAnimationFrame(()=>{e=null;const e=this.extractCSSValues(),t=e.columnCount,i=e.columnGap;(t!==this.columnCount||i!==this.columnGap)&&(this.columnCount=t,this.columnGap=i,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount))})};window.addEventListener("resize",t)}handleImages(){this.galleryItems.forEach(e=>{e.querySelectorAll?.("img").forEach(t=>{t.complete||t.addEventListener("load",()=>{const e=this.extractCSSValues(),t=e.columnGap!==this.columnGap,i=e.columnCount!==this.columnCount;t||i?(this.columnGap=e.columnGap,this.columnCount=e.columnCount,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount)):(this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount))},{once:!0})})}),window.addEventListener("load",()=>{this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount)},{once:!0})}}function init(){document.querySelectorAll(S).forEach(e=>{if("1"===e.dataset.masonryInited)return;const t=e.querySelectorAll(":scope > *");new M(e,t),e.dataset.masonryInited="1"})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init();const OBS=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(t=>{if(1!==t.nodeType)return;t.matches&&t.matches(S)&&"1"!==t.dataset.masonryInited&&(()=>{const e=t.querySelectorAll(":scope > *");new M(t,e),t.dataset.masonryInited="1"})();const i=t.querySelectorAll?.(S);i&&i.forEach(e=>{"1"!==e.dataset.masonryInited&&(()=>{const t=e.querySelectorAll(":scope > *");new M(e,t),e.dataset.masonryInited="1"})()})})})});OBS.observe(document.body,{childList:!0,subtree:!0})})();
