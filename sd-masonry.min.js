(()=>{let e={MASONRY_LAYOUT_SELECTOR:"[sd-masonry]"};class t{constructor(e,t){this.galleryElement=e,this.galleryItems=Array.from(t),this.galleryClassName="c-masonry-layout",this.columnClassName="c-masonry-column",this.itemClassName="c-masonry-item",this.useBalance=this.galleryElement.hasAttribute("sd-masonry-balance"),this.cssValues=this.extractCSSValues(),this.columnCount=this.cssValues.columnCount,this.columnGap=this.cssValues.columnGap,this.galleryStyles={display:"flex","flex-wrap":"wrap","justify-content":"flex-start"},this.generate(this.columnCount),this.handleResponsive(),this.handleImages()}extractCSSValues(){let e=window.getComputedStyle(this.galleryElement),t=e.columnCount,l=e.columnGap,s;if("auto"===t)s=this.calculateAutoColumns();else if("none"===t||"inherit"===t)s=3;else{let a=parseInt(t,10);s=isNaN(a)?3:Math.max(a,1)}let n=parseFloat(l)||20;return{columnCount:s,columnGap:n}}calculateAutoColumns(){let e=this.galleryElement.offsetWidth;return Math.floor(e/200)||1}generate(e){let t=[];this.galleryElement.classList.add(this.galleryClassName),Object.assign(this.galleryElement.style,this.galleryStyles),this.columnGap>0&&(this.galleryElement.style.gap=`${this.columnGap}px`);for(let l=1;l<=e;l++){let s=document.createElement("div");s.classList.add(this.columnClassName,`column-${l}`),s.style.flex="1",s.style.minWidth="0",this.galleryElement.append(s),t.push(s)}this.useBalance?this.distributeItemsIntelligently(t):this.distributeItemsSequentially(t)}distributeItemsSequentially(e){this.galleryItems.forEach((t,l)=>{let s=l%e.length,a=e[s];a.append(t),t.classList.add(this.itemClassName),this.columnGap>0&&(t.style.marginBottom=`${this.columnGap}px`)})}distributeItemsIntelligently(e){let t=Array(e.length).fill(0);this.galleryItems.forEach(l=>{let s=t.indexOf(Math.min(...t)),a=e[s];a.append(l),l.classList.add(this.itemClassName),this.columnGap>0&&(l.style.marginBottom=`${this.columnGap}px`),t[s]+=l.offsetHeight,this.columnGap>0&&(t[s]+=this.columnGap)})}handleResponsive(){let e=null,t=()=>{e||(e=requestAnimationFrame(()=>{e=null;let t=this.extractCSSValues(),l=t.columnCount,s=t.columnGap;(l!==this.columnCount||s!==this.columnGap)&&(this.columnCount=l,this.columnGap=s,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount))}))};window.addEventListener("resize",t)}handleImages(){this.galleryItems.forEach(e=>{e.querySelectorAll?.("img").forEach(e=>{e.complete||e.addEventListener("load",()=>{let e=this.extractCSSValues(),t=e.columnGap!==this.columnGap,l=e.columnCount!==this.columnCount;t||l?(this.columnGap=e.columnGap,this.columnCount=e.columnCount,this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount)):(this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount))},{once:!0})})}),window.addEventListener("load",()=>{this.galleryElement.querySelectorAll(`.${this.columnClassName}`).forEach(e=>e.remove()),this.generate(this.columnCount)},{once:!0})}}function l(){document.querySelectorAll(e.MASONRY_LAYOUT_SELECTOR).forEach(e=>{if("1"===e.dataset.masonryInited)return;let l=e.querySelectorAll(":scope > *");new t(e,l),e.dataset.masonryInited="1"})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l();let s=new MutationObserver(l=>{l.forEach(l=>{l.addedNodes.forEach(l=>{if(1!==l.nodeType)return;if(l.matches&&l.matches(e.MASONRY_LAYOUT_SELECTOR)&&"1"!==l.dataset.masonryInited){let s=l.querySelectorAll(":scope > *");new t(l,s),l.dataset.masonryInited="1"}let a=l.querySelectorAll?.(e.MASONRY_LAYOUT_SELECTOR);a&&a.forEach(e=>{if("1"===e.dataset.masonryInited)return;let l=e.querySelectorAll(":scope > *");new t(e,l),e.dataset.masonryInited="1"})})})});s.observe(document.body,{childList:!0,subtree:!0})})();
